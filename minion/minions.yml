---
- hosts: minions
  tasks:
  - name: write the config files for kubelet
    template: src=templates/kubelet.j2 dest=/etc/kubernetes/kubelet
  - name: write the config files for proxy
    template: src=templates/proxy.j2 dest=/etc/kubernetes/proxy
  - name: Enable kubelet
    service: name=kubelet enabled=yes state=started
  - name: Enable proxy
    service: name=kube-proxy enabled=yes state=started
  - name: Open firewalld port for the kubelet
    firewalld: port=10250/tcp permanent=true state=enabled
  handlers:
    - name: restart kubelet
      service: name=kubelet state=restarted
    - name: restart proxy
      service: name=kube-proxy state=restarted
